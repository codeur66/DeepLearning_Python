


--
ValueError: Input 0 of layer dense is incompatible with the layer:
expected axis -1 of input shape to have value 1000000 but received
input with shape [None, 10000].
--
The investigation to solution:
#1# use of run_eagerly=True) in compile () to debug what happens during fit(),  set to None when fixed the bug to regain the speed.
#2# check the summary() print.

Model: "sequential"
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
embedding (Embedding)        (None, 10000, 100)        1000000
_________________________________________________________________
flatten (Flatten)            (None, 1000000)           0           <--- here seems a multiplication of (None x 10000 x 100)
_________________________________________________________________  the error says "Input 0 of layer dense is incompatible..."
dense (Dense)                (None, 32)                32000032    the layer 0 is the Dense, it took weights of shape (10000 x 100)
_________________________________________________________________  but embedding gives 10000x100 so we check the embedding layer
dense_1 (Dense)              (None, 1)                 33          in model.add(Embedding(max_words, embeddings_dimension, input_length=max_len))
=================================================================  The Flatten does not affect the dimensions only flattens whatever it takes.

#3# print the shapes of the data and structures and variables related to the network.

x_train, y_train, x_val, y_val ;  (200, 100) (200,) (10000, 100) (10000,) <---- same dimension
Found 100 coefficients. <---- same dimension
Found 400000 word vectors.<---- same dimension
Found 88582 unique tokens.<---- same dimension
embedding_matrix shape :  (10000, 100)    <---- same dimension
Found 100 coefficients. <---- same dimension
Found 400000 word vectors. <----same dimension


#4# plot
sudo apt install graphviz # for keras.utils.plot_model
pip install pydot  # for keras.utils.plot_model

kears.utils.plot_model(model, show_shapes=True)



#######Corrected Version#######

Model: "sequential"
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
embedding (Embedding)        (None, 100, 100)          1000000
_________________________________________________________________
flatten (Flatten)            (None, 10000)             0
_________________________________________________________________
dense (Dense)                (None, 32)                320032
_________________________________________________________________
dense_1 (Dense)              (None, 1)                 33
=================================================================
Total params: 1,320,065
Trainable params: 1,320,065
Non-trainable params: 0
_________________________________________________________________


2020-10-26 23:51:16.505640: I tensorflow/core/profiler/lib/profiler_session.cc:164] Profiler session started.
Epoch 1/10
2020-10-26 23:51:18.988882: I tensorflow/core/profiler/lib/profiler_session.cc:164] Profiler session started.
1/7 [===>..........................] - ETA: 0s - loss: 0.6931 - acc: 0.3438WARNING:tensorflow:From /home/nikoscf/PycharmProjects/DeepLearningWithPython/venv/lib/python3.6/site-packages/tensorflow/python/ops/summary_ops_v2.py:1277: stop (from tensorflow.python.eager.profiler) is deprecated and will be removed after 2020-07-01.
Instructions for updating:
use `tf.profiler.experimental.stop` instead.
2020-10-26 23:51:19.125224: I tensorflow/core/profiler/rpc/client/save_profile.cc:176] Creating directory: ./logs/train/plugins/profile/2020_10_26_23_51_19
2020-10-26 23:51:19.129592: I tensorflow/core/profiler/rpc/client/save_profile.cc:182] Dumped gzipped tool data for trace.json.gz to ./logs/train/plugins/profile/2020_10_26_23_51_19/nikosCF.trace.json.gz
2020-10-26 23:51:19.202160: I tensorflow/core/profiler/rpc/client/save_profile.cc:176] Creating directory: ./logs/train/plugins/profile/2020_10_26_23_51_19
2020-10-26 23:51:19.202874: I tensorflow/core/profiler/rpc/client/save_profile.cc:182] Dumped gzipped tool data for memory_profile.json.gz to ./logs/train/plugins/profile/2020_10_26_23_51_19/nikosCF.memory_profile.json.gz
2020-10-26 23:51:19.204364: I tensorflow/python/profiler/internal/profiler_wrapper.cc:111] Creating directory: ./logs/train/plugins/profile/2020_10_26_23_51_19Dumped tool data for xplane.pb to ./logs/train/plugins/profile/2020_10_26_23_51_19/nikosCF.xplane.pb
Dumped tool data for overview_page.pb to ./logs/train/plugins/profile/2020_10_26_23_51_19/nikosCF.overview_page.pb
Dumped tool data for input_pipeline.pb to ./logs/train/plugins/profile/2020_10_26_23_51_19/nikosCF.input_pipeline.pb
Dumped tool data for tensorflow_stats.pb to ./logs/train/plugins/profile/2020_10_26_23_51_19/nikosCF.tensorflow_stats.pb
Dumped tool data for kernel_stats.pb to ./logs/train/plugins/profile/2020_10_26_23_51_19/nikosCF.kernel_stats.pb

WARNING:tensorflow:Callbacks method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0275s vs `on_train_batch_end` time: 0.1892s). Check your callbacks.
7/7 [==============================] - 1s 122ms/step - loss: 0.6928 - acc: 0.5400 - val_loss: 0.6932 - val_acc: 0.4957
Epoch 2/10
7/7 [==============================] - 0s 61ms/step - loss: 0.6921 - acc: 0.5900 - val_loss: 0.6933 - val_acc: 0.4957
Epoch 3/10
7/7 [==============================] - 0s 56ms/step - loss: 0.6915 - acc: 0.5900 - val_loss: 0.6933 - val_acc: 0.4957

Process finished with exit code 0
